# Cinnox Line Bot 
Linebot service API implemented the following features
- Get messages that a user send in a period of time.
- Send message to a certain user with line user ID.

Packages
- [gin](https://github.com/gin-gonic/gin) for rest service
- [zap](https://github.com/uber-go/zap) for logging
- [viper](https://github.com/spf13/viper) for setting up config
- [cobra](https://github.com/spf13/cobra) for building command line
- [mongo-go-driver](https://github.com/mongodb/mongo-go-driver) for mongoDB operations
- [line-bot-sdk for](https://github.com/line/line-bot-sdk-go) linebot client

## Table of Contents
---


- [Cinnox Line Bot](#cinnox-line-bot)
  - [Table of Contents](#table-of-contents)
  - [Commit Style](#commit-style)
  - [Quick Start](#quick-start)
  - [API](#api)
    - [Get message](#get-message)
      - [Request params](#request-params)
      - [Response bidy](#response-bidy)
    - [Push message to a certain user](#push-message-to-a-certain-user)
      - [Request body](#request-body)
      - [Response bidy](#response-bidy-1)

## Commit Style
---
- Follow [Conventional Commit Messages](https://gist.github.com/qoomon/5dfcdf8eec66a051ecd85625518cfd13)

## Quick Start 
---
- Add user config in {project_dir}/config/config.yaml
- Build the app with `go build`


```shell
go build .
```

- Start mongoDB service with `Makefile`
  - note that the Makefile would auto install docker cli and colima runtime
    
```shell
make dev
```

- Run the command generated by Cobra to initialize the collection `message.line`

```shell
./{your-app-name} create line
```

- Start the service

```shell
./{your-app-name}
```

- Expose Service with [Ngrok](https://ngrok.com/)
  - You could follow this [article](https://ngrok.com/docs/getting-started) for ngrok installation and usage

```shell
ngrok http {your-service-port}
```

- Parse Ngrok Host to LineBot Webhook URL
   - You could follow this [document](https://developers.line.biz/en/docs/messaging-api/building-bot/) for the linebot quick setup

## API
---

### Get message 

#### Request params
| Field | Type | Description |  
| :---- | :----| :---------- | 
| user  | string| user to send | 
| start_time | int64 | unix micro time | 
| end_time | int64 | unix micro time | 

#### Response bidy
| Field | Type | Description |  
| :---- | :----| :---------- | 
| status | string | Success or Failed | 
| user  | string| user to query  | 
| time | int64 | unix micro time | 
| content | string | message text content | 

- request sample
```shell
curl 'http://{your-host}:{your-port}/message?user=U731727d29c9f4944fee1f0a4987acf35&start_time=1&end_time=1675911508890446'
```

--- 


### Push message to a certain user

#### Request body
| Field | Type | Description |  
| :---- | :----| :---------- | 
| user  | string| user to send | 
| content | string | message content | 

#### Response bidy
| Field | Type | Description |  
| :---- | :----| :---------- | 
| status | string | Success or Failed | 
| user  | string| user to send | 
| content | string | message content | 

- request sample
```shell
curl -X POST 'http://{your-host}:{your-port}/message' \
-H 'Content-Type: application/json' \
-d '{
    "user":"U731727d29c9f4944fee1f0a4987acf35",
    "content":"Hello"
}'
```

